<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com">
  <title>Tasker</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="styles.css">
</head>
<body data-theme="auto">
  <div id="app">

    <!-- Login Screen -->
    <!-- Main Application Screen -->
    <div id="main-screen" class="screen active">
      <div class="app-layout">

        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
          <div class="sidebar-resize-handle"></div>
          <div class="sidebar-header">
            <img src="../assets/tasks.png" alt="Tasker" class="sidebar-logo sidebar-logo-light" />
            <img src="../assets/tasks-dark.png" alt="Tasker" class="sidebar-logo sidebar-logo-dark" />
            <h2>Tasker</h2>
          </div>

          <nav class="sidebar-nav" id="sidebar-folders">
            <!-- Folders will be rendered here -->
          </nav>

          <div class="sidebar-agent" id="sidebar-agent">
            <div class="agent-header">
              <span class="material-icons">smart_toy</span>
              <span>AI Agent</span>
            </div>

            <div class="agent-quick-prompts">
              <select id="agent-quick-select" class="agent-quick-select">
                <option value="">Quick Prompts...</option>
                <option value="Show my 3 highest priority tasks">High Priority Tasks</option>
                <option value="Show the work due in the next 3 days">Due in 3 Days</option>
                <option value="What should I work on now?">What to Work On</option>
              </select>
            </div>

            <div class="agent-chat" id="agent-chat">
              <div class="agent-messages" id="agent-messages">
                <div class="agent-message agent-message-system">
                  Ask me about your tasks!
                </div>
              </div>
            </div>

            <div class="agent-input-container">
              <input type="text" id="agent-input" class="agent-input" placeholder="Ask about your tasks..." />
              <button id="agent-send-btn" class="agent-send-btn" title="Send message">
                <span class="material-icons">send</span>
              </button>
            </div>
          </div>

          <div class="sidebar-footer">
            <button class="sidebar-icon-btn" data-view="profile" title="Dashboard">
              <span class="material-icons">show_chart</span>
            </button>
            <button class="sidebar-icon-btn" data-view="settings" title="Settings">
              <span class="material-icons">settings</span>
            </button>
            <button id="help-btn" class="sidebar-icon-btn" title="Help">
              <span class="material-icons">help_outline</span>
            </button>
          </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">

          <!-- Tasks View -->
          <div id="tasks-view" class="view active">
            <header class="view-header">
              <h1>Tasks</h1>
              <div class="header-actions">
                <button id="expand-collapse-btn" class="icon-btn" title="Expand All">
                  <span id="expand-collapse-icon">⊞</span>
                </button>
                <div class="filter-dropdown">
                  <button id="filter-toggle-btn" class="filter-toggle">
                    <span id="filter-label">Filters</span>
                    <span class="filter-arrow">▼</span>
                  </button>
                  <div id="filter-menu" class="filter-menu">
                    <label class="filter-option">
                      <input type="checkbox" value="all" checked />
                      <span>All</span>
                    </label>
                    <label class="filter-option">
                      <input type="checkbox" value="high-priority" />
                      <span>High Priority</span>
                    </label>
                    <label class="filter-option">
                      <input type="checkbox" value="complete" />
                      <span>Complete</span>
                    </label>
                    <label class="filter-option">
                      <input type="checkbox" value="not-complete" />
                      <span>Not Complete</span>
                    </label>
                    <label class="filter-option">
                      <input type="checkbox" value="past-due" />
                      <span>Past Due</span>
                    </label>
                    <label class="filter-option">
                      <input type="checkbox" value="due-soon" />
                      <span>Due Soon (3 days)</span>
                    </label>
                    <label class="filter-option">
                      <input type="checkbox" value="deleted" />
                      <span>Deleted <span id="deleted-count" class="filter-count"></span></span>
                    </label>
                  </div>
                </div>
                <div class="sort-dropdown">
                  <button id="sort-toggle-btn" class="sort-toggle">
                    <span id="sort-label">Sort</span>
                    <span class="sort-arrow">▼</span>
                  </button>
                  <div id="sort-menu" class="sort-menu">
                    <label class="sort-option">
                      <input type="radio" name="sort" value="default" checked />
                      <span>Default</span>
                    </label>
                    <label class="sort-option">
                      <input type="radio" name="sort" value="priority" />
                      <span>Priority</span>
                    </label>
                    <label class="sort-option">
                      <input type="radio" name="sort" value="due-date" />
                      <span>Due Date</span>
                    </label>
                    <label class="sort-option">
                      <input type="radio" name="sort" value="created" />
                      <span>Creation Date</span>
                    </label>
                  </div>
                </div>
                <span id="platform-info" class="info-badge"></span>
              </div>
            </header>

            <div class="view-content">
              <section class="task-input-section">
                <div class="task-input-wrapper">
                  <input type="text" id="taskInput" class="input-lg" placeholder="Add a new task..." />
                  <button id="pasteBtn" class="paste-btn" title="Paste from clipboard" style="display: none;">
                    <span class="material-icons">content_paste</span>
                  </button>
                </div>
                <button id="addTaskBtn" class="btn-primary">Add</button>
              </section>

              <section class="task-list-section">
                <div id="taskContainer">
                  <p class="empty-state">No tasks yet. Add one above!</p>
                </div>
              </section>
            </div>
          </div>

          <!-- Profile View -->
          <div id="profile-view" class="view">
            <header class="view-header">
              <h1>Dashboard</h1>
            </header>

            <div class="view-content">
              <div class="dashboard-grid">
                <div class="metric-card">
                  <div class="metric-header">
                    <span class="material-icons metric-icon">list_alt</span>
                    <span class="metric-title">Total Tasks</span>
                  </div>
                  <div class="metric-value" id="stat-total">0</div>
                  <div class="metric-description">All tasks across folders</div>
                </div>

                <div class="metric-card">
                  <div class="metric-header">
                    <span class="material-icons metric-icon">check_circle</span>
                    <span class="metric-title">Completed</span>
                  </div>
                  <div class="metric-value" id="stat-completed">0</div>
                  <div class="metric-description">Tasks marked as done</div>
                </div>

                <div class="metric-card">
                  <div class="metric-header">
                    <span class="material-icons metric-icon">radio_button_unchecked</span>
                    <span class="metric-title">Pending</span>
                  </div>
                  <div class="metric-value" id="stat-pending">0</div>
                  <div class="metric-description">Tasks still in progress</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Settings View -->
          <div id="settings-view" class="view">
            <header class="view-header">
              <div style="display: flex; align-items: center; gap: 1rem;">
                <h1>Settings</h1>
                <div id="settings-saving-spinner" class="saving-spinner" style="display: none;">
                  <div class="spinner"></div>
                  <span class="saving-text">Saving...</span>
                </div>
              </div>
            </header>

            <div class="view-content">
              <div class="settings-section">
                <h3>Appearance</h3>

                <div class="setting-item">
                  <label for="theme-select">Theme</label>
                  <select id="theme-select" class="select">
                    <option value="auto">System Default</option>
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                  </select>
                  <p class="setting-description">Choose your preferred color theme</p>
                </div>
              </div>

              <div class="settings-section">
                <h3>Task Folders</h3>

                <div class="setting-item">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <label>Folders</label>
                    <button id="add-folder-settings-btn" class="btn-secondary">
                      <span class="material-icons" style="font-size: 18px; vertical-align: middle;">add</span>
                      Add Folder
                    </button>
                  </div>
                  <div id="folder-list" class="folder-list">
                    <p class="setting-description" style="text-align: center; padding: 2rem;">No folders configured. Click "Add Folder" to get started.</p>
                  </div>
                  <p class="setting-description">Manage multiple task folders for different projects or purposes</p>
                </div>
              </div>

              <div class="settings-section">
                <h3>Startup</h3>

                <div class="setting-item">
                  <label for="auto-launch-checkbox">
                    <input type="checkbox" id="auto-launch-checkbox" style="width: auto; margin-right: 0.5rem;" />
                    Launch Tasker on Windows startup
                  </label>
                  <p class="setting-description">Automatically start Tasker when you log in to Windows</p>
                </div>

                <div class="setting-item">
                  <label for="start-minimized-checkbox">
                    <input type="checkbox" id="start-minimized-checkbox" style="width: auto; margin-right: 0.5rem;" />
                    Start minimized to system tray
                  </label>
                  <p class="setting-description">Start with the window hidden in the system tray</p>
                </div>
              </div>

              <div class="settings-section">
                <h3>Keyboard Shortcuts</h3>

                <div class="setting-item">
                  <label for="global-hotkey-input">Quick Add Task Hotkey</label>
                  <input type="text" id="global-hotkey-input" class="input-lg" readonly placeholder="Press keys to set hotkey..." />
                  <p class="setting-description">Global keyboard shortcut to bring Tasker forward and add a new task (default: Ctrl+Alt+T)</p>
                  <button id="reset-hotkey-btn" class="btn-secondary" style="margin-top: 0.5rem;">Reset to Default</button>
                </div>
              </div>

              <div class="settings-section">
                <h3>Data Management</h3>

                <div class="setting-item">
                  <button id="clear-deleted-btn" class="btn-secondary">Clear Deleted Items</button>
                  <p class="setting-description">Permanently remove all deleted tasks</p>
                </div>

                <div class="setting-item">
                  <button id="clear-data-btn" class="btn-secondary">Clear All Tasks</button>
                  <p class="setting-description">Remove all tasks from storage (cannot be undone)</p>
                </div>
              </div>

              <div class="settings-section">
                <h3>Ollama Integration</h3>

                <div class="setting-item">
                  <label for="ollama-path-input">Ollama Executable Path</label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <input type="text" id="ollama-path-input" class="input-lg" placeholder="Auto-detecting..." readonly style="flex: 1;" />
                    <button id="browse-ollama-btn" class="icon-btn" title="Browse for ollama executable">
                      <span class="material-icons">folder_open</span>
                    </button>
                    <button id="detect-ollama-btn" class="btn-secondary" style="white-space: nowrap;">Detect</button>
                  </div>
                  <p class="setting-description">Path to the Ollama executable for AI integration</p>
                </div>

                <div class="setting-item" id="ollama-model-section" style="display: none;">
                  <label for="ollama-model-select">Model</label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <select id="ollama-model-select" class="select" style="flex: 1; max-width: 100%;">
                      <option value="">Loading models...</option>
                    </select>
                    <button id="refresh-models-btn" class="icon-btn" title="Refresh model list">
                      <span class="material-icons">refresh</span>
                    </button>
                  </div>
                  <p class="setting-description">Select the Ollama model to use for AI features</p>
                </div>

                <div class="setting-item">
                  <p id="ollama-status" style="color: var(--text-secondary); font-size: 0.9rem; margin: 0;">
                    <span id="ollama-status-icon" style="margin-right: 0.5rem;">⏳</span>
                    <span id="ollama-status-text">Detecting Ollama...</span>
                  </p>
                </div>
              </div>

              <div class="settings-section">
                <h3>AI Agent Quick Prompts</h3>

                <div class="setting-item">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <label>Quick Prompts</label>
                    <button id="add-prompt-btn" class="btn-secondary">
                      <span class="material-icons" style="font-size: 18px; vertical-align: middle;">add</span>
                      Add Prompt
                    </button>
                  </div>
                  <div id="prompts-list" class="prompts-list">
                    <!-- Prompts will be added here dynamically -->
                  </div>
                  <p class="setting-description">Customize quick prompts for the AI agent. These appear in the dropdown menu for quick access.</p>
                </div>
              </div>

              <div class="settings-section">
                <h3>About</h3>

                <div class="setting-item">
                  <p><strong>Version:</strong> <span id="settings-version">1.0.0</span></p>
                  <p><strong>Platform:</strong> <span id="settings-platform">Unknown</span></p>
                </div>
              </div>
            </div>
          </div>

        </main>
      </div>
    </div>

    <!-- Add Folder Modal -->
    <div id="add-folder-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add Task Folder</h2>
        </div>

        <div class="modal-body">
          <div class="form-group">
            <label for="folder-path-input">Folder Path</label>
            <div style="display: flex; gap: 0.5rem;">
              <input type="text" id="folder-path-input" class="input-lg" placeholder="Paste or browse for a folder path..." style="flex: 1;" />
              <button id="browse-folder-btn" class="icon-btn" title="Browse for folder">
                <span class="material-icons">folder_open</span>
              </button>
            </div>
            <p class="setting-description">Enter the full path to a folder where tasks will be stored</p>
          </div>

          <div class="form-group">
            <label for="folder-name-input">Folder Name (optional)</label>
            <input type="text" id="folder-name-input" class="input-lg" placeholder="Auto-generated from path if left blank" />
            <p class="setting-description">Give this folder a friendly name</p>
          </div>
        </div>

        <div class="modal-footer">
          <button id="add-folder-cancel-btn" class="btn-secondary">Cancel</button>
          <button id="add-folder-save-btn" class="btn-primary">Add Folder</button>
        </div>
      </div>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Help & Shortcuts</h2>
        </div>

        <div class="modal-body">
          <h3>Keyboard Shortcuts</h3>

          <div class="shortcuts-section">
            <h4>Window Controls</h4>
            <div class="shortcut-item">
              <kbd>Ctrl</kbd> + <kbd>←</kbd>
              <span class="shortcut-description">Snap window to left side of screen</span>
            </div>
            <div class="shortcut-item">
              <kbd>Ctrl</kbd> + <kbd>→</kbd>
              <span class="shortcut-description">Snap window to right side of screen</span>
            </div>
            <div class="shortcut-item">
              <kbd>Ctrl</kbd> + <kbd>↑</kbd>
              <span class="shortcut-description">Center window and reset to normal size</span>
            </div>
            <div class="shortcut-item">
              <kbd>Ctrl</kbd> + <kbd>↓</kbd> or <kbd>Alt</kbd> + <kbd>F4</kbd>
              <span class="shortcut-description">Hide window to system tray</span>
            </div>
            <div class="shortcut-item">
              <kbd>Ctrl</kbd> + <span style="font-size: 0.9rem;">Click ✕</span>
              <span class="shortcut-description">Exit application completely (hold Ctrl when clicking close button)</span>
            </div>
          </div>

          <div class="shortcuts-section">
            <h4>Global Shortcuts</h4>
            <div class="shortcut-item">
              <kbd id="help-global-hotkey">Ctrl+Alt+T</kbd>
              <span class="shortcut-description">Show Tasker and focus task input (works anywhere)</span>
            </div>
          </div>

          <div class="shortcuts-section">
            <h4>General</h4>
            <div class="shortcut-item">
              <kbd>Escape</kbd>
              <span class="shortcut-description">Close modals and dialogs</span>
            </div>
            <div class="shortcut-item">
              <kbd>Enter</kbd>
              <span class="shortcut-description">Add new task (when in task input)</span>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button id="help-close-btn" class="btn-primary">Close</button>
        </div>
      </div>
    </div>

    <!-- Task Edit Modal -->
    <div id="task-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Edit Task</h2>
        </div>

        <div class="modal-body">
          <div class="form-group">
            <label for="modal-title">Title</label>
            <input type="text" id="modal-title" class="input-lg" placeholder="Task title" />
          </div>

          <div class="form-group">
            <label for="modal-details">Details</label>
            <textarea id="modal-details" class="textarea-lg" rows="8" placeholder="Task details and notes..."></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="modal-priority">Priority</label>
              <select id="modal-priority" class="select">
                <option value="normal">Normal</option>
                <option value="high">High</option>
              </select>
            </div>

            <div class="form-group">
              <label for="modal-completed">
                <input type="checkbox" id="modal-completed" style="width: auto; margin-right: 0.5rem;" />
                Completed
              </label>
            </div>

            <div class="form-group">
              <label for="modal-due-date">Due Date</label>
              <input type="date" id="modal-due-date" class="input-lg" />
            </div>
          </div>

          <div class="form-group">
            <label>Created</label>
            <input type="text" id="modal-created" class="input-lg" readonly disabled />
          </div>
        </div>

        <div class="modal-footer">
          <button id="modal-undelete-btn" class="btn-secondary" style="margin-right: auto; display: none;">Undelete</button>
          <button id="modal-cancel-btn" class="btn-secondary">Cancel</button>
          <button id="modal-save-btn" class="btn-primary">Close</button>
        </div>
      </div>
    </div>

  </div>

  <script src="renderer.js"></script>
</body>
</html>
