<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self'">
  <title>Tasker</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="styles.css">
</head>
<body data-theme="auto">
  <div id="app">

    <!-- Login Screen -->
    <!-- Main Application Screen -->
    <div id="main-screen" class="screen active">
      <div class="app-layout">

        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
          <div class="sidebar-resize-handle"></div>
          <div class="sidebar-header">
            <img src="../assets/tasks.png" alt="Tasker" class="sidebar-logo sidebar-logo-light" />
            <img src="../assets/tasks-dark.png" alt="Tasker" class="sidebar-logo sidebar-logo-dark" />
            <h2>Tasker</h2>
          </div>

          <nav class="sidebar-nav" id="sidebar-folders">
            <!-- Folders will be rendered here -->
          </nav>

          <div class="agent-resize-handle" id="agent-resize-handle"></div>

          <div class="sidebar-agent" id="sidebar-agent">
            <div class="agent-header">
              <span class="material-icons">smart_toy</span>
              <div class="agent-header-text">
                <span class="agent-label">AI Agent</span>
                <span id="agent-model-name" class="agent-model-name"></span>
              </div>
            </div>

            <div class="agent-chat" id="agent-chat">
              <div class="agent-messages" id="agent-messages">
                <div class="agent-message agent-message-system">
                  Ask me about your tasks!
                </div>
              </div>
            </div>

            <div class="agent-input-container">
              <input type="text" id="agent-input" class="agent-input" placeholder="Ask about your tasks..." />
              <div class="agent-quick-dropdown">
                <button id="agent-quick-btn" class="agent-quick-btn" title="Quick prompts">
                  <span class="material-icons">bolt</span>
                </button>
                <div id="agent-quick-menu" class="agent-quick-menu">
                  <button class="agent-quick-option" data-prompt="Show my 3 highest priority tasks">High Priority Tasks</button>
                  <button class="agent-quick-option" data-prompt="Show the work due in the next 3 days">Due in 3 Days</button>
                  <button class="agent-quick-option" data-prompt="What should I work on now?">What to Work On</button>
                </div>
              </div>
              <button id="agent-send-btn" class="agent-send-btn" title="Send message">
                <span class="material-icons">send</span>
              </button>
            </div>
          </div>

          <div class="sidebar-footer">
            <button class="sidebar-icon-btn" data-view="profile" title="Dashboard">
              <span class="material-icons">show_chart</span>
            </button>
            <button class="sidebar-icon-btn" data-view="settings" title="Settings">
              <span class="material-icons">settings</span>
            </button>
            <button class="sidebar-icon-btn" data-view="help" title="Help">
              <span class="material-icons">help_outline</span>
            </button>
          </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">

          <!-- Tasks View -->
          <div id="tasks-view" class="view active">
            <header class="view-header">
              <h1>Tasks</h1>
              <div class="header-actions">
                <button id="expand-collapse-btn" class="icon-btn" title="Expand All">
                  <span id="expand-collapse-icon">⊞</span>
                </button>
                <div class="view-toggle">
                  <button id="view-list-btn" class="view-toggle-btn active" title="List View">
                    <span class="material-icons">view_list</span>
                  </button>
                  <button id="view-kanban-btn" class="view-toggle-btn" title="Kanban View">
                    <span class="material-icons">view_kanban</span>
                  </button>
                </div>
                <div class="filter-dropdown">
                  <button id="filter-toggle-btn" class="filter-toggle">
                    <span id="filter-label">Filters</span>
                    <span class="filter-arrow">▼</span>
                  </button>
                  <div id="filter-menu" class="filter-menu">
                    <label class="filter-option">
                      <input type="checkbox" value="all" checked />
                      <span>All</span>
                    </label>
                    <label class="filter-option">
                      <input type="checkbox" value="high-priority" />
                      <span>High Priority</span>
                    </label>
                    <label class="filter-option">
                      <input type="checkbox" value="complete" />
                      <span>Complete</span>
                    </label>
                    <label class="filter-option">
                      <input type="checkbox" value="not-complete" />
                      <span>Not Complete</span>
                    </label>
                    <label class="filter-option">
                      <input type="checkbox" value="past-due" />
                      <span>Past Due</span>
                    </label>
                    <label class="filter-option">
                      <input type="checkbox" value="due-soon" />
                      <span>Due Soon (3 days)</span>
                    </label>
                    <label class="filter-option">
                      <input type="checkbox" value="with-due-date" />
                      <span>Has Due Date</span>
                    </label>
                    <label class="filter-option">
                      <input type="checkbox" value="deleted" />
                      <span>Deleted <span id="deleted-count" class="filter-count"></span></span>
                    </label>
                  </div>
                </div>
                <div class="sort-dropdown">
                  <button id="sort-toggle-btn" class="sort-toggle">
                    <span id="sort-label">Sort</span>
                    <span class="sort-arrow">▼</span>
                  </button>
                  <div id="sort-menu" class="sort-menu">
                    <label class="sort-option">
                      <input type="radio" name="sort" value="default" checked />
                      <span>Default</span>
                    </label>
                    <label class="sort-option">
                      <input type="radio" name="sort" value="priority" />
                      <span>Priority</span>
                    </label>
                    <label class="sort-option">
                      <input type="radio" name="sort" value="due-date" />
                      <span>Due Date</span>
                    </label>
                    <label class="sort-option">
                      <input type="radio" name="sort" value="created" />
                      <span>Creation Date</span>
                    </label>
                  </div>
                </div>
                <span id="platform-info" class="info-badge"></span>
              </div>
            </header>

            <div class="view-content">
              <section class="task-input-section">
                <div class="task-input-wrapper">
                  <input type="text" id="taskInput" class="input-lg" placeholder="Add a new task..." />
                  <button id="pasteBtn" class="paste-btn" title="Paste from clipboard" style="display: none;">
                    <span class="material-icons">content_paste</span>
                  </button>
                </div>
                <button id="addTaskBtn" class="btn-primary">Add</button>
              </section>

              <section class="task-list-section">
                <div id="taskContainer">
                  <p class="empty-state">No tasks yet. Add one above!</p>
                </div>
              </section>

              <!-- Kanban Board -->
              <section class="kanban-board-section" id="kanbanBoard" style="display: none;">
                <!-- Kanban columns will be rendered here -->
              </section>

              <!-- Git Timeline Ribbon -->
              <section class="timeline-section" id="timeline-section" style="display: none;">
                <div class="timeline-container" id="timeline-container">
                  <div class="timeline-track" id="timeline-track">
                    <!-- Timeline points will be rendered here -->
                  </div>
                </div>
              </section>

              <!-- Timeline Tooltip (positioned globally) -->
              <div id="timeline-tooltip" class="timeline-tooltip-global" style="display: none;"></div>
            </div>
          </div>

          <!-- Profile View -->
          <div id="profile-view" class="view">
            <header class="view-header">
              <h1>Dashboard</h1>
            </header>

            <div class="view-content">
              <div class="dashboard-grid">
                <div class="metric-card">
                  <div class="metric-header">
                    <span class="material-icons metric-icon">list_alt</span>
                    <span class="metric-title">Total Tasks</span>
                  </div>
                  <div class="metric-value" id="stat-total">0</div>
                  <div class="metric-description">All tasks across folders</div>
                </div>

                <div class="metric-card">
                  <div class="metric-header">
                    <span class="material-icons metric-icon">check_circle</span>
                    <span class="metric-title">Completed</span>
                  </div>
                  <div class="metric-value" id="stat-completed">0</div>
                  <div class="metric-description">Tasks marked as done</div>
                </div>

                <div class="metric-card">
                  <div class="metric-header">
                    <span class="material-icons metric-icon">radio_button_unchecked</span>
                    <span class="metric-title">Pending</span>
                  </div>
                  <div class="metric-value" id="stat-pending">0</div>
                  <div class="metric-description">Tasks still in progress</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Help View -->
          <div id="help-view" class="view">
            <header class="view-header">
              <h1>Help & Shortcuts</h1>
            </header>

            <div class="view-content">
              <div class="settings-section">
                <h3>Keyboard Shortcuts</h3>

                <div class="shortcuts-section">
                  <h4>Window Controls</h4>
                  <div class="shortcut-item">
                    <kbd>Ctrl</kbd> + <kbd>←</kbd>
                    <span class="shortcut-description">Snap window to left side of screen</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Ctrl</kbd> + <kbd>→</kbd>
                    <span class="shortcut-description">Snap window to right side of screen</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Ctrl</kbd> + <kbd>↑</kbd>
                    <span class="shortcut-description">Center window and reset to normal size</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Ctrl</kbd> + <kbd>↓</kbd> or <kbd>Alt</kbd> + <kbd>F4</kbd>
                    <span class="shortcut-description">Hide window to system tray</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Ctrl</kbd> + <span style="font-size: 0.9rem;">Click ✕</span>
                    <span class="shortcut-description">Exit application completely (hold Ctrl when clicking close button)</span>
                  </div>
                </div>

                <div class="shortcuts-section">
                  <h4>View Switching</h4>
                  <div class="shortcut-item">
                    <kbd>Ctrl</kbd> + <kbd>K</kbd>
                    <span class="shortcut-description">Switch to Kanban view</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Ctrl</kbd> + <kbd>L</kbd>
                    <span class="shortcut-description">Switch to List view</span>
                  </div>
                </div>

                <div class="shortcuts-section">
                  <h4>Filter & Sort</h4>
                  <div class="shortcut-item">
                    <kbd>Ctrl</kbd> + <kbd>F</kbd>
                    <span class="shortcut-description">Open Filter menu</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Ctrl</kbd> + <kbd>S</kbd>
                    <span class="shortcut-description">Open Sort menu</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>↑</kbd> / <kbd>↓</kbd>
                    <span class="shortcut-description">Navigate filter/sort options (when menu open)</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Space</kbd>
                    <span class="shortcut-description">Toggle filter checkbox / Select sort option</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Enter</kbd>
                    <span class="shortcut-description">Apply and close filter/sort menu</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Escape</kbd>
                    <span class="shortcut-description">Close filter/sort menu</span>
                  </div>
                </div>

                <div class="shortcuts-section">
                  <h4>Folder Switching</h4>
                  <div class="shortcut-item">
                    <kbd>Ctrl</kbd> + <kbd>1</kbd>...<kbd>9</kbd>
                    <span class="shortcut-description">Switch to folder 1-9 (works anywhere in app)</span>
                  </div>
                </div>

                <div class="shortcuts-section">
                  <h4>Multi-Select</h4>
                  <div class="shortcut-item">
                    <kbd>Ctrl</kbd> + <span class="shortcut-key">Click</span>
                    <span class="shortcut-description">Toggle task selection (add/remove from selection)</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Shift</kbd> + <span class="shortcut-key">Click</span>
                    <span class="shortcut-description">Select range of tasks from last selected to clicked</span>
                  </div>
                  <div class="shortcut-item">
                    <span class="shortcut-key">Click</span>
                    <span class="shortcut-description">Clear selection and select single task</span>
                  </div>
                </div>

                <div class="shortcuts-section">
                  <h4>Task Navigation</h4>
                  <div class="shortcut-item">
                    <kbd>↑</kbd> / <kbd>↓</kbd>
                    <span class="shortcut-description">Navigate up/down between tasks</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>←</kbd> / <kbd>→</kbd>
                    <span class="shortcut-description">Navigate left/right between Kanban columns</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Shift</kbd> + <kbd>↑</kbd> / <kbd>↓</kbd>
                    <span class="shortcut-description">Extend selection up/down (multi-select via keyboard)</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Shift</kbd> + <kbd>←</kbd> / <kbd>→</kbd>
                    <span class="shortcut-description">Extend selection left/right in Kanban columns</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Space</kbd>
                    <span class="shortcut-description">Expand/collapse selected task (if it has children)</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Enter</kbd>
                    <span class="shortcut-description">Open detail dialog for selected task</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Delete</kbd>
                    <span class="shortcut-description">Soft delete selected task(s) (move to deleted folder)</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Ctrl</kbd> + <kbd>Delete</kbd>
                    <span class="shortcut-description">Permanently delete selected task(s)</span>
                  </div>
                </div>

                <div class="shortcuts-section">
                  <h4>Global Shortcuts</h4>
                  <div class="shortcut-item">
                    <kbd id="help-global-hotkey">Ctrl+Alt+T</kbd>
                    <span class="shortcut-description">Show Tasker and focus task input (works anywhere)</span>
                  </div>
                </div>

                <div class="shortcuts-section">
                  <h4>View Navigation</h4>
                  <div class="shortcut-item">
                    <kbd>F1</kbd>
                    <span class="shortcut-description">Open Help view</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>F2</kbd>
                    <span class="shortcut-description">Open Dashboard (Profile) view</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>F5</kbd>
                    <span class="shortcut-description">Open Settings view</span>
                  </div>
                </div>

                <div class="shortcuts-section">
                  <h4>General</h4>
                  <div class="shortcut-item">
                    <kbd>Escape</kbd>
                    <span class="shortcut-description">Close modals and dialogs</span>
                  </div>
                  <div class="shortcut-item">
                    <kbd>Enter</kbd>
                    <span class="shortcut-description">Add new task (when in task input)</span>
                  </div>
                </div>

                <div class="shortcuts-section">
                  <h4>Task Actions</h4>
                  <div class="shortcut-item">
                    <kbd>Ctrl</kbd> + <span style="font-size: 0.9rem;">Click Delete</span>
                    <span class="shortcut-description">Permanently delete task and all children (cannot be undone)</span>
                  </div>
                </div>

                <div class="shortcuts-section">
                  <h4>Timeline Controls</h4>
                  <div class="shortcut-item">
                    <kbd>Ctrl</kbd> + <span style="font-size: 0.9rem;">Mouse Wheel</span>
                    <span class="shortcut-description">Zoom in or out on the timeline (for folders with version control)</span>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <h3>Settings Guide</h3>

                <div class="shortcuts-section">
                  <h4>Appearance</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Theme:</strong> Choose between Light, Dark, or System Default themes. System Default automatically matches your operating system's theme preference.
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>Task Folders</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Managing Folders:</strong> Organize tasks into separate folders for different projects or contexts. Click "Add Folder" to create a new task folder, specify the storage location, and optionally enable version control for that folder.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Removing Folders:</strong> Click the delete button to remove a folder from Tasker (files remain on disk). Hold Ctrl while clicking the delete button (which turns yellow) to permanently delete the folder and all its contents from disk. No confirmation is required for permanent deletion.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Version Control:</strong> When adding a folder, check "Enable version control" to initialize a Git repository. This allows you to track changes to your tasks over time. Git must be configured first before this option is available.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Folder Badge:</strong> Folders with version control enabled show a branch icon badge in both the sidebar and settings.
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>Startup</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Launch on Startup:</strong> Enable this to automatically start Tasker when you log in to Windows. Useful for keeping your tasks always accessible.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Start Minimized:</strong> When enabled, Tasker will start hidden in the system tray instead of showing the window. Use the global hotkey or system tray icon to restore the window.
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>Keyboard Shortcuts</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Quick Add Hotkey:</strong> Customize the global keyboard shortcut that brings up Tasker from anywhere in your system. Click the input field and press your desired key combination. Default is Ctrl+Alt+T.
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>Data Management</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Clear Deleted Items:</strong> Permanently removes all tasks in the deleted folder. This action cannot be undone.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Clear All Tasks:</strong> Removes all tasks from storage. Use with extreme caution as this cannot be undone.
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>Ollama Integration (AI Agent)</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Setup:</strong> Click "Detect" to automatically find your Ollama installation, or use "Browse" to manually select the ollama executable. Once detected, select a model from the dropdown.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Using the AI Agent:</strong> The AI Agent in the sidebar can answer questions about your tasks, help prioritize work, and provide insights. It has access to all your task data including titles, priorities, due dates, and descriptions.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Quick Prompts:</strong> Use the lightning bolt button to access pre-configured prompts for common queries.
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>Git Integration</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Setup:</strong> Click "Detect" to find Git automatically, or "Browse" to select git.exe manually. Git is required to use version control features for task folders.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Download:</strong> If you don't have Git installed, click the download link to get Git for Windows.
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>Version Control Features</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Automatic Commits:</strong> When version control is enabled on a folder, Tasker automatically commits changes to Git whenever you create, update, move, or delete tasks. Each commit includes a descriptive message about what changed (e.g., "Create task: Project Alpha" or "Move task to child of Setup").
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Timeline View:</strong> Folders with version control show a timeline ribbon at the bottom of the Tasks view. This timeline displays your commit history visually as points on a horizontal timeline, ordered chronologically from left (oldest) to right (newest).
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>First Commit Badge:</strong> The first commit in a repository is highlighted in green to mark the beginning of your version history.
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>Using the Timeline</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Hover for Details:</strong> Move your mouse over any point on the timeline to see a tooltip with the commit message. This gives you a quick preview without needing to click.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Click for Full Details:</strong> Click on any timeline point to open a modal showing complete commit information including the full commit hash, author, date, and message.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Timeline Zoom:</strong> Hold Ctrl (or Cmd on Mac) and scroll your mouse wheel while hovering over the timeline to zoom in or out. This helps you see closely-packed commits more clearly. Zoom ranges from 50% to 2000%.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Timeline Position:</strong> Commits are positioned proportionally based on their timestamps. If commits are close together in time, their timeline points will be close together visually.
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>Rollback Feature</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>What is Rollback:</strong> The rollback feature lets you restore your tasks to any previous commit state. When you rollback, all task files in the folder are reset to exactly how they were at that point in time.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>How to Rollback:</strong> Click on a timeline point to view the commit details, then click "Rollback to This Commit" button. A confirmation dialog will warn you about the consequences before proceeding.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>⚠️ IMPORTANT WARNING:</strong> Rollback is destructive and cannot be undone. Any changes made after the selected commit will be permanently lost. Make sure you really want to go back before confirming the rollback.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>After Rollback:</strong> After a rollback, your tasks will be in the exact state they were at the selected commit. The timeline will show all commits up to that point. Later commits are preserved in Git's reflog but won't appear on the timeline.
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>AI Agent Quick Prompts</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Customizing Prompts:</strong> Create your own quick prompts for frequently asked questions. Click "Add Prompt" to create a new one, then type your question or instruction. These appear in the lightning bolt menu in the AI Agent sidebar.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Example Prompts:</strong> "What should I work on now?", "Show my highest priority tasks", "What's due this week?"
                  </p>
                </div>
              </div>

              <div class="settings-section">
                <h3>Task Management Tips</h3>

                <div class="shortcuts-section">
                  <h4>Creating Tasks</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    Type in the task input field and press Enter or click "Add" to create a new task. Tasks are automatically saved to your active folder.
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>Organizing Tasks</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Drag and Drop:</strong> Click and drag tasks to reorder them. Drag a task onto another task to make it a child (subtask).
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Expand/Collapse:</strong> Click the arrow button next to a task to show or hide its children. Use the ⊞/⊟ button in the header to expand or collapse all tasks at once.
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>Editing Tasks</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Quick Edit:</strong> Click on a task's text to edit the title inline. Press Enter to save or Escape to cancel.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Full Edit:</strong> Click anywhere else on a task item to open the full editor where you can set priority, due date, add detailed notes, and mark as complete.
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>Clickable Links</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Automatic Link Detection:</strong> URLs in task details are automatically detected and displayed as clickable links. This works for http://, https://, www., and ftp:// URLs.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Opening Links:</strong> Simply click any blue underlined link to open it in your default browser. Links work in both the task detail modal and kanban card descriptions.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Editing Mode:</strong> When viewing task details, click anywhere on the text (except on a link) to switch to editing mode where you can modify the raw text. Click away or blur the field to return to viewing mode with clickable links.
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>Single Instance</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>One Window Only:</strong> Tasker allows only one instance to run at a time. If you try to launch the application while it's already running, the existing window will be brought into focus instead of opening a second window.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Restoring Window:</strong> If the window is minimized or hidden when you launch Tasker again, it will be automatically restored and brought to the front. This prevents accidentally opening multiple instances.
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>Filtering and Sorting</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Filters:</strong> Use the Filters dropdown to show only specific types of tasks (high priority, completed, past due, etc.). Multiple filters can be active at once.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Sort:</strong> Choose how to order your tasks: by priority, due date, creation date, or default order (priority + due date + creation date).
                  </p>
                </div>

                <div class="shortcuts-section">
                  <h4>Deleting Tasks</h4>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Soft Delete:</strong> Click the delete button to move a task to the deleted folder. You can restore it later by filtering for deleted tasks and clicking the restore button.
                  </p>
                  <p class="setting-description" style="margin-bottom: 0.5rem;">
                    <strong>Permanent Delete:</strong> Hold Ctrl while clicking the delete button (which turns yellow) to permanently delete a task and all its children. This cannot be undone.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Settings View -->
          <div id="settings-view" class="view">
            <header class="view-header">
              <div style="display: flex; align-items: center; gap: 1rem;">
                <h1>Settings</h1>
                <div id="settings-saving-spinner" class="saving-spinner" style="display: none;">
                  <div class="spinner"></div>
                  <span class="saving-text">Saving...</span>
                </div>
              </div>
            </header>

            <div class="view-content">
              <div class="settings-section">
                <h3>Appearance</h3>

                <div class="setting-item">
                  <label for="theme-select">Theme</label>
                  <select id="theme-select" class="select">
                    <option value="auto">System Default</option>
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                  </select>
                  <p class="setting-description">Choose your preferred color theme</p>
                </div>
              </div>

              <div class="settings-section">
                <h3>Task Folders</h3>

                <div class="setting-item">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <label>Folders</label>
                    <button id="add-folder-settings-btn" class="btn-secondary">
                      <span class="material-icons" style="font-size: 18px; vertical-align: middle;">add</span>
                      Add Folder
                    </button>
                  </div>
                  <div id="folder-list" class="folder-list">
                    <p class="setting-description" style="text-align: center; padding: 2rem;">No folders configured. Click "Add Folder" to get started.</p>
                  </div>
                  <p class="setting-description">Manage multiple task folders for different projects or purposes</p>
                </div>
              </div>

              <div class="settings-section">
                <h3>Startup</h3>

                <div class="setting-item">
                  <label for="auto-launch-checkbox">
                    <input type="checkbox" id="auto-launch-checkbox" style="width: auto; margin-right: 0.5rem;" />
                    Launch Tasker on Windows startup
                  </label>
                  <p class="setting-description">Automatically start Tasker when you log in to Windows</p>
                </div>

                <div class="setting-item">
                  <label for="start-minimized-checkbox">
                    <input type="checkbox" id="start-minimized-checkbox" style="width: auto; margin-right: 0.5rem;" />
                    Start minimized to system tray
                  </label>
                  <p class="setting-description">Start with the window hidden in the system tray</p>
                </div>
              </div>

              <div class="settings-section">
                <h3>Keyboard Shortcuts</h3>

                <div class="setting-item">
                  <label for="global-hotkey-input">Quick Add Task Hotkey</label>
                  <input type="text" id="global-hotkey-input" class="input-lg" readonly placeholder="Press keys to set hotkey..." />
                  <p class="setting-description">Global keyboard shortcut to bring Tasker forward and add a new task (default: Ctrl+Alt+T)</p>
                  <button id="reset-hotkey-btn" class="btn-secondary" style="margin-top: 0.5rem;">Reset to Default</button>
                </div>
              </div>

              <div class="settings-section">
                <h3>Data Management</h3>

                <div class="setting-item">
                  <button id="clear-deleted-btn" class="btn-secondary">Clear Deleted Items</button>
                  <p class="setting-description">Permanently remove all deleted tasks</p>
                </div>

                <div class="setting-item">
                  <button id="clear-data-btn" class="btn-secondary">Clear All Tasks</button>
                  <p class="setting-description">Remove all tasks from storage (cannot be undone)</p>
                </div>
              </div>

              <div class="settings-section">
                <h3>Ollama Integration</h3>

                <div class="setting-item">
                  <label for="ollama-path-input">Ollama Executable Path</label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <input type="text" id="ollama-path-input" class="input-lg" placeholder="Auto-detecting..." readonly style="flex: 1;" />
                    <button id="browse-ollama-btn" class="icon-btn" title="Browse for ollama executable">
                      <span class="material-icons">folder_open</span>
                    </button>
                    <button id="detect-ollama-btn" class="btn-secondary" style="white-space: nowrap;">Detect</button>
                  </div>
                  <p class="setting-description">Path to the Ollama executable for AI integration</p>
                </div>

                <div class="setting-item" id="ollama-model-section" style="display: none;">
                  <label for="ollama-model-select">Model</label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <select id="ollama-model-select" class="select" style="flex: 1; max-width: 100%;">
                      <option value="">Loading models...</option>
                    </select>
                    <button id="refresh-models-btn" class="icon-btn" title="Refresh model list">
                      <span class="material-icons">refresh</span>
                    </button>
                  </div>
                  <p class="setting-description">Select the Ollama model to use for AI features</p>
                </div>

                <div class="setting-item">
                  <p id="ollama-status" style="color: var(--text-secondary); font-size: 0.9rem; margin: 0;">
                    <span id="ollama-status-icon" style="margin-right: 0.5rem;">⏳</span>
                    <span id="ollama-status-text">Detecting Ollama...</span>
                  </p>
                </div>
              </div>

              <div class="settings-section">
                <h3>Git Integration</h3>

                <div class="setting-item">
                  <label for="git-path-input">Git Executable Path</label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <input type="text" id="git-path-input" class="input-lg" placeholder="Auto-detecting..." readonly style="flex: 1;" />
                    <button id="browse-git-btn" class="icon-btn" title="Browse for git executable">
                      <span class="material-icons">folder_open</span>
                    </button>
                    <button id="detect-git-btn" class="btn-secondary" style="white-space: nowrap;">Detect</button>
                  </div>
                  <p class="setting-description">Path to the Git executable for version control integration</p>
                </div>

                <div class="setting-item">
                  <p id="git-status" style="color: var(--text-secondary); font-size: 0.9rem; margin: 0;">
                    <span id="git-status-icon" style="margin-right: 0.5rem;">⏳</span>
                    <span id="git-status-text">Detecting Git...</span>
                  </p>
                  <p style="margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-tertiary);">
                    Don't have Git installed? <a href="https://gitforwindows.org/" target="_blank" style="color: var(--accent-primary); text-decoration: none;">Download Git for Windows</a>
                  </p>
                </div>
              </div>

              <div class="settings-section">
                <h3>Dropbox Integration</h3>

                <div class="setting-item">
                  <label>OAuth2 Authentication (Recommended)</label>
                  <div style="display: flex; gap: 0.5rem; align-items: center; margin-bottom: 0.5rem;">
                    <input type="text" id="dropbox-client-id-input" class="input-lg" placeholder="Enter your Dropbox App Key (Client ID)..." style="flex: 1;" />
                    <button id="oauth-login-btn" class="btn-primary" style="white-space: nowrap;">
                      <span class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 0.25rem;">login</span>
                      Sign in with Dropbox
                    </button>
                  </div>
                  <p class="setting-description">
                    OAuth2 uses refresh tokens so you won't need to re-authorize frequently.
                    <a href="https://www.dropbox.com/developers/apps" target="_blank" style="color: var(--accent-primary); text-decoration: none;">Create an app</a> to get your App Key.
                    <br><strong>Redirect URI:</strong> <code style="background: var(--bg-secondary); padding: 0.15rem 0.4rem; border-radius: 3px; font-size: 0.85em;">http://localhost:53682/oauth/callback</code>
                  </p>
                </div>

                <div class="setting-item" style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                  <label for="dropbox-token-input">Legacy: Access Token</label>
                  <input type="password" id="dropbox-token-input" class="input-lg" placeholder="Or enter access token manually (not recommended)..." />
                  <p class="setting-description" style="color: var(--text-secondary); font-size: 0.85rem;">
                    Access tokens expire and need to be refreshed manually. Use OAuth2 above for automatic refresh.
                  </p>
                </div>

                <div class="setting-item" style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                  <label>Connection Status</label>
                  <div id="dropbox-status" style="display: none;">
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin: 0 0 1rem 0;">
                      <span id="dropbox-status-icon" style="margin-right: 0.5rem;">⏳</span>
                      <span id="dropbox-status-text">Testing connection...</span>
                    </p>
                  </div>
                  <div id="dropbox-user-info" style="display: none; margin-bottom: 1rem; padding: 0.75rem; background: var(--bg-secondary); border-radius: 4px; border: 1px solid var(--border-color);">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                      <span class="material-icons" style="color: var(--accent-primary); font-size: 20px;">cloud</span>
                      <strong style="color: var(--text-primary);">Connected to Dropbox</strong>
                    </div>
                    <p style="margin: 0.25rem 0; font-size: 0.85rem; color: var(--text-secondary);">
                      <strong>Name:</strong> <span id="dropbox-user-name"></span>
                    </p>
                    <p style="margin: 0.25rem 0; font-size: 0.85rem; color: var(--text-secondary);">
                      <strong>Email:</strong> <span id="dropbox-user-email"></span>
                    </p>
                    <button id="disconnect-dropbox-btn" class="btn-danger" style="margin-top: 0.75rem; font-size: 0.85rem; padding: 0.4rem 0.75rem;">
                      Disconnect
                    </button>
                  </div>
                  <button id="test-dropbox-btn" class="btn-secondary" style="width: 100%;">
                    <span class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 0.25rem;">link</span>
                    Test Connection
                  </button>
                  <p class="setting-description" style="margin-top: 0.5rem;">
                    Test your Dropbox connection (works with both OAuth2 and legacy access tokens).
                  </p>
                </div>
              </div>

              <div class="settings-section">
                <h3>Task Statuses</h3>

                <div class="setting-item">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <label>Statuses</label>
                    <button id="add-status-btn" class="btn-secondary">
                      <span class="material-icons" style="font-size: 18px; vertical-align: middle;">add</span>
                      Add Status
                    </button>
                  </div>
                  <div id="statuses-list" class="statuses-list">
                    <!-- Statuses will be added here dynamically -->
                  </div>
                  <p class="setting-description">Customize task statuses. The "Completed" status is required and represents a finished task.</p>
                </div>
              </div>

              <div class="settings-section">
                <h3>AI Agent Quick Prompts</h3>

                <div class="setting-item">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <label>Quick Prompts</label>
                    <button id="add-prompt-btn" class="btn-secondary">
                      <span class="material-icons" style="font-size: 18px; vertical-align: middle;">add</span>
                      Add Prompt
                    </button>
                  </div>
                  <div id="prompts-list" class="prompts-list">
                    <!-- Prompts will be added here dynamically -->
                  </div>
                  <p class="setting-description">Customize quick prompts for the AI agent. These appear in the dropdown menu for quick access.</p>
                </div>
              </div>

              <div class="settings-section">
                <h3>About</h3>

                <div class="setting-item">
                  <p><strong>Version:</strong> <span id="settings-version">1.0.0</span></p>
                  <p><strong>Platform:</strong> <span id="settings-platform">Unknown</span></p>
                </div>
              </div>
            </div>
          </div>

        </main>
      </div>
    </div>

    <!-- Add Folder Modal -->
    <div id="add-folder-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add Task Folder</h2>
        </div>

        <div class="modal-body">
          <div class="form-group">
            <label>Storage Type</label>
            <div style="display: flex; gap: 1.5rem; margin-bottom: 0.5rem;">
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="radio" name="storage-type" value="local" id="storage-type-local" checked style="width: auto; margin-right: 0.5rem;" />
                <span class="material-icons" style="margin-right: 0.25rem; font-size: 20px;">folder</span>
                Local Disk
              </label>
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="radio" name="storage-type" value="dropbox" id="storage-type-dropbox" style="width: auto; margin-right: 0.5rem;" />
                <span class="material-icons" style="margin-right: 0.25rem; font-size: 20px;">cloud</span>
                Dropbox
              </label>
            </div>
            <p class="setting-description">Choose where to store your task files</p>
          </div>

          <div class="form-group" id="local-folder-section">
            <label for="folder-path-input">Folder Path</label>
            <div style="display: flex; gap: 0.5rem;">
              <input type="text" id="folder-path-input" class="input-lg" placeholder="Paste or browse for a folder path..." style="flex: 1;" />
              <button id="browse-folder-btn" class="icon-btn" title="Browse for folder">
                <span class="material-icons">folder_open</span>
              </button>
            </div>
            <p class="setting-description">Enter the full path to a local folder where tasks will be stored</p>
          </div>

          <div class="form-group" id="dropbox-folder-section" style="display: none;">
            <label for="dropbox-path-input">Dropbox Path</label>
            <div style="display: flex; gap: 0.5rem;">
              <input type="text" id="dropbox-path-input" class="input-lg" placeholder="Select a Dropbox folder..." readonly style="flex: 1;" />
              <button id="browse-dropbox-btn" class="icon-btn" title="Browse Dropbox">
                <span class="material-icons">cloud</span>
              </button>
            </div>
            <p class="setting-description">Select a folder in your Dropbox where tasks will be stored</p>
          </div>

          <div class="form-group">
            <label for="folder-name-input">Folder Name (optional)</label>
            <input type="text" id="folder-name-input" class="input-lg" placeholder="Auto-generated from path if left blank" />
            <p class="setting-description">Give this folder a friendly name</p>
          </div>

          <div class="form-group">
            <label for="enable-version-control">
              <input type="checkbox" id="enable-version-control" style="width: auto; margin-right: 0.5rem;" />
              Enable version control (Git)
            </label>
            <p class="setting-description">Initialize a Git repository in this folder to track changes to your tasks</p>
          </div>
        </div>

        <div class="modal-footer">
          <button id="add-folder-cancel-btn" class="btn-secondary">Cancel</button>
          <button id="add-folder-save-btn" class="btn-primary">Add Folder</button>
        </div>
      </div>
    </div>

    <!-- Task Edit Modal -->
    <div id="task-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Edit Task</h2>
        </div>

        <div class="modal-body">
          <div class="form-group">
            <label for="modal-title">Title</label>
            <input type="text" id="modal-title" class="input-lg" placeholder="Task title" />
          </div>

          <div class="form-group">
            <label for="modal-details">Details</label>
            <div class="modal-details-container">
              <div id="modal-details-display" class="modal-details-display" style="display: none;"></div>
              <textarea id="modal-details" class="textarea-lg" rows="8" placeholder="Task details and notes..."></textarea>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="modal-priority">Priority</label>
              <select id="modal-priority" class="select">
                <option value="normal">Normal</option>
                <option value="high">High</option>
              </select>
            </div>

            <div class="form-group">
              <label for="modal-status">Status</label>
              <select id="modal-status" class="select">
                <option value="Pending">Pending</option>
              </select>
            </div>

            <div class="form-group">
              <label for="modal-due-date">Due Date</label>
              <input type="date" id="modal-due-date" class="input-lg" />
            </div>
          </div>

          <div class="form-group">
            <label>Created</label>
            <input type="text" id="modal-created" class="input-lg" readonly disabled />
          </div>

          <div class="form-group" id="modal-parent-container" style="display: none;">
            <label>Parent Task</label>
            <div id="modal-parent" class="parent-task-link"></div>
          </div>
        </div>

        <div class="modal-footer">
          <button id="modal-undelete-btn" class="btn-secondary" style="margin-right: auto; display: none;">Undelete</button>
          <button id="modal-cancel-btn" class="btn-secondary">Cancel</button>
          <button id="modal-save-btn" class="btn-primary">Close</button>
        </div>
      </div>
    </div>

    <!-- Commit Details Modal -->
    <div id="commit-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Commit Details</h2>
        </div>

        <div class="modal-body">
          <div class="form-group">
            <label>Commit Hash</label>
            <input type="text" id="commit-hash" class="input-lg" readonly disabled />
          </div>

          <div class="form-group">
            <label>Message</label>
            <textarea id="commit-message" class="textarea-lg" rows="3" readonly disabled></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Author</label>
              <input type="text" id="commit-author" class="input-lg" readonly disabled />
            </div>

            <div class="form-group">
              <label>Date</label>
              <input type="text" id="commit-date" class="input-lg" readonly disabled />
            </div>
          </div>

          <div class="form-group">
            <p class="setting-description" style="margin-top: 1rem; color: var(--danger);">
              <strong>Warning:</strong> Rollback will reset all tasks in this folder to the state at this commit. Any changes made after this commit will be lost. This action cannot be undone.
            </p>
          </div>
        </div>

        <div class="modal-footer">
          <button id="commit-cancel-btn" class="btn-secondary">Cancel</button>
          <button id="commit-rollback-btn" class="btn-primary" style="background: var(--danger); border-color: var(--danger);">Rollback to This Commit</button>
        </div>
      </div>
    </div>

    <!-- Dropbox Folder Browser Modal -->
    <div id="dropbox-browser-modal" class="modal">
      <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
          <h2>Browse Dropbox</h2>
        </div>

        <div class="modal-body">
          <div class="form-group">
            <label>Current Path</label>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <input type="text" id="dropbox-current-path" class="input-lg" value="/" readonly style="flex: 1;" />
              <button id="dropbox-up-btn" class="icon-btn" title="Go up one level">
                <span class="material-icons">arrow_upward</span>
              </button>
              <button id="dropbox-refresh-btn" class="icon-btn" title="Refresh">
                <span class="material-icons">refresh</span>
              </button>
            </div>
          </div>

          <div class="form-group">
            <label>Folders</label>
            <div id="dropbox-folder-list" class="dropbox-folder-list">
              <p style="text-align: center; padding: 2rem; color: var(--text-secondary);">Loading...</p>
            </div>
          </div>

          <div class="form-group">
            <label>New Folder (Optional)</label>
            <div style="display: flex; gap: 0.5rem;">
              <input type="text" id="dropbox-new-folder-input" class="input-lg" placeholder="Enter folder name..." style="flex: 1;" />
              <button id="dropbox-create-folder-btn" class="btn-secondary">Create</button>
            </div>
            <p class="setting-description">Create a new folder in the current location</p>
          </div>
        </div>

        <div class="modal-footer">
          <button id="dropbox-browser-cancel-btn" class="btn-secondary">Cancel</button>
          <button id="dropbox-browser-select-btn" class="btn-primary">Select Current Folder</button>
        </div>
      </div>
    </div>

  </div>

  <script src="renderer.js"></script>
</body>
</html>
